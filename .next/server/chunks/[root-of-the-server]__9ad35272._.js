module.exports=[44498,e=>{"use strict";function t(e,t,a,r){let n=[],o=a/111.111,s=a/(111.111*Math.cos(Math.PI/180*e)),i=e-o,l=t-s,c=2*o/(r-1),u=2*s/(r-1);for(let e=0;e<r;e++)for(let t=0;t<r;t++)n.push({lat:i+e*c,lng:l+t*u});return n}e.s(["generateGrid",()=>t])},57775,e=>{"use strict";async function t(e,t,a,r){try{console.log(`[Scraper] Starting scrape for: ${t} at ${a}, ${r}`),await e.goto(`https://www.google.com/maps/search/${encodeURIComponent(t)}/@${a},${r},14z/`,{waitUntil:"networkidle",timeout:6e4});try{await Promise.race([e.waitForSelector('[role="article"]',{timeout:1e4}),e.waitForSelector(".qBF1Pd",{timeout:1e4}),e.waitForSelector('[role="feed"]',{timeout:1e4})])}catch(e){console.log("[Scraper] Warning: Standard result selectors not found, trying fallback extraction anyway.")}await e.evaluate(async()=>{let e=e=>new Promise(t=>setTimeout(t,e)),t=document.querySelector('[role="feed"]')||document.body;for(let a=0;a<3;a++)t.scrollBy(0,500+500*Math.random()),await e(300+500*Math.random())});let n=await e.evaluate(()=>{let e=[],t=Array.from(document.querySelectorAll('div[role="article"]'));0===t.length&&(t=Array.from(document.querySelectorAll('a[href*="/maps/place/"]')).map(e=>e.closest("div")||e));let a=new Set;return t.forEach((t,r)=>{if(e.length>=20)return;let n="",o=t.getAttribute("aria-label");if(o&&!o.includes("stars")&&o.length>2&&(n=o),!n){let e=t.querySelector('.fontHeadlineSmall, .qBF1Pd, [role="heading"]');n=e?.textContent?.trim()||""}if(!n||n.length<2||(n=n.split(" Â· ")[0].replace(/\. \d+$/,"").trim(),a.has(n.toLowerCase())))return;a.add(n.toLowerCase());let s=t.querySelector('[role="img"][aria-label*="stars"]'),i=(s?.getAttribute("aria-label")||"").match(/([0-9.]+)\s+stars/),l=i?parseFloat(i[1]):void 0,c=(t.innerText||"").split("\n").find(e=>e.match(/\d+/)&&e!==n&&e.length>5)||"";e.push({name:n,rating:l,reviews:0,address:c.trim(),rank:e.length+1})}),e});return console.log(`[Scraper] Successfully extracted ${n.length} results.`),n}catch(t){console.error(`[Scraper] Error scraping ${a},${r}:`,t);try{let t=new Date().getTime();await e.screenshot({path:`./scrape-error-${a}-${r}-${t}.png`}),console.log(`[Scraper] Debug screenshot saved: ./scrape-error-${a}-${r}-${t}.png`)}catch(e){console.error("[Scraper] Could not save debug screenshot")}return[]}}e.s(["scrapeGMB",()=>t])},24047,e=>e.a(async(t,a)=>{try{let t=await e.y("playwright-9b51c99ca474dcf1");e.n(t),a()}catch(e){a(e)}},!0),30421,e=>e.a(async(t,a)=>{try{var r=e.i(98043),n=e.i(44498),o=e.i(57775),s=e.i(24047),i=t([s]);async function l(e){let t=await r.prisma.scan.findUnique({where:{id:e}});if(!t)throw Error("Scan not found");await r.prisma.scan.update({where:{id:e},data:{status:"RUNNING"}});let a=(0,n.generateGrid)(t.centerLat,t.centerLng,t.radius,t.gridSize),i=await s.chromium.launch({headless:!0}),l=await i.newContext({viewport:{width:1280,height:800},userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"});await l.grantPermissions(["geolocation"]);let c=await l.newPage();try{for(let n of a){let a=await r.prisma.scan.findUnique({where:{id:e},select:{status:!0}});if(!a||"STOPPED"===a.status){console.log(`Scan ${e} was stopped.`);break}console.log(`Scraping point: ${n.lat}, ${n.lng}`),await l.setGeolocation({latitude:n.lat,longitude:n.lng});let s=await (0,o.scrapeGMB)(c,t.keyword,n.lat,n.lng),i=null,u=null;if(t.businessName){let e=s.find(e=>e.name.toLowerCase().includes(t.businessName.toLowerCase()));e&&(i=e.rank,u=e.name)}await r.prisma.result.create({data:{scanId:t.id,lat:n.lat,lng:n.lng,topResults:JSON.stringify(s),rank:i,targetName:u}}),await new Promise(e=>setTimeout(e,1500+2e3*Math.random()))}await r.prisma.scan.update({where:{id:e},data:{status:"COMPLETED"}})}catch(t){console.error(`[Scanner] Critical failure in scan ${e}:`,t),await r.prisma.scan.update({where:{id:e},data:{status:"FAILED"}})}finally{await i.close()}}[s]=i.then?(await i)():i,e.s(["runScan",()=>l]),a()}catch(e){a(e)}},!1),54685,e=>e.a(async(t,a)=>{try{var r=e.i(98043),n=e.i(89171),o=e.i(30421),s=t([o]);async function i(){try{let e=await r.prisma.scan.findMany({orderBy:{createdAt:"desc"}});return n.NextResponse.json({scans:e})}catch(e){return console.error("Scans GET error:",e),n.NextResponse.json({scans:[]})}}async function l(e){try{let{keyword:t,address:a,radius:s,gridSize:i,frequency:l,businessName:c}=await e.json(),u=await r.prisma.scan.create({data:{keyword:t,centerLat:41.8781,centerLng:-87.6298,radius:parseFloat(s)||5,gridSize:parseInt(i)||3,frequency:l||"ONCE",businessName:c||void 0,status:"PENDING"}});return(0,o.runScan)(u.id).catch(console.error),n.NextResponse.json(u)}catch(e){return console.error("Scan creation CRITICAL error:",e),e instanceof Error&&(console.error("Error message:",e.message),console.error("Error stack:",e.stack)),n.NextResponse.json({error:"Failed to create scan",details:String(e)},{status:500})}}[o]=s.then?(await s)():s,e.s(["GET",()=>i,"POST",()=>l]),a()}catch(e){a(e)}},!1),912,e=>e.a(async(t,a)=>{try{var r=e.i(47909),n=e.i(74017),o=e.i(96250),s=e.i(59756),i=e.i(19884),l=e.i(74677),c=e.i(69741),u=e.i(16795),d=e.i(87718),p=e.i(95169),h=e.i(47587),w=e.i(66012),g=e.i(70101),m=e.i(26937),f=e.i(10372),y=e.i(93695);e.i(52474);var R=e.i(220),v=e.i(54685),E=t([v]);[v]=E.then?(await E)():E;let x=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/scans/route",pathname:"/api/scans",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/scans/route.ts",nextConfigOutput:"",userland:v}),{workAsyncStorage:A,workUnitAsyncStorage:N,serverHooks:b}=x;function S(){return(0,o.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:N})}async function C(e,t,a){x.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/scans/route";r=r.replace(/\/index$/,"")||"/";let o=await x.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:E,nextConfig:S,parsedUrl:C,isDraftMode:A,prerenderManifest:N,routerServerContext:b,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,resolvedPathname:$,clientReferenceManifest:O,serverActionsManifest:I}=o,M=(0,c.normalizeAppPath)(r),q=!!(N.dynamicRoutes[M]||N.routes[$]),k=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,C,!1):t.end("This page could not be found"),null);if(q&&!A){let e=!!N.routes[$],t=N.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await k();throw new y.NoFallbackError}}let _=null;!q||x.isDev||A||(_=$,_="/index"===_?"/":_);let U=!0===x.isDev||!q,D=q&&!U;I&&O&&(0,l.setManifestsSingleton)({page:r,clientReferenceManifest:O,serverActionsManifest:I});let H=e.method||"GET",F=(0,i.getTracer)(),L=F.getActiveScopeSpan(),G={params:E,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,n)=>x.onRequestError(e,t,r,n,b)},sharedContext:{buildId:v}},j=new u.NodeNextRequest(e),B=new u.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(j,(0,d.signalFromNodeResponse)(t));try{let o=async e=>x.handle(K,G).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=F.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${r}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),c=async s=>{var i,c;let u=async({previousCacheEntry:n})=>{try{if(!l&&P&&T&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await o(s);e.fetchMetrics=G.renderOpts.fetchMetrics;let i=G.renderOpts.pendingWaitUntil;i&&a.waitUntil&&(a.waitUntil(i),i=void 0);let c=G.renderOpts.collectedTags;if(!q)return await (0,w.sendResponse)(j,B,r,G.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(r.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==G.renderOpts.collectedRevalidate&&!(G.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&G.renderOpts.collectedRevalidate,n=void 0===G.renderOpts.collectedExpire||G.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:G.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,b),t}},d=await x.handleResponse({req:e,nextConfig:S,cacheKey:_,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:l});if(!q)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&q||p.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,w.sendResponse)(j,B,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};L?await c(L):await F.withPropagatedContext(e.headers,()=>F.trace(p.BaseServerSpan.handleRequest,{spanName:`${H} ${r}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},c))}catch(t){if(t instanceof y.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,b),q)throw t;return await (0,w.sendResponse)(j,B,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>S,"routeModule",()=>x,"serverHooks",()=>b,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>N]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__9ad35272._.js.map