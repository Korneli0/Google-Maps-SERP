{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/danish/codeplayground/GMBserp/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY;AAElB,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/danish/codeplayground/GMBserp/src/app/api/proxies/fetch/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\nexport async function POST() {\n    console.log('[ProxyFetch] POST request received at /api/proxies/fetch');\n    try {\n        const sources = [\n            { name: 'TheSpeedX', url: 'https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/http.txt' },\n            { name: 'ShiftyTR', url: 'https://raw.githubusercontent.com/ShiftyTR/Proxy-List/master/http.txt' },\n            { name: 'Monosans', url: 'https://raw.githubusercontent.com/monosans/proxy-list/main/proxies/http.txt' },\n            { name: 'ProxyListPlus', url: 'https://raw.githubusercontent.com/mmpx12/proxy-list/master/http.txt' },\n            { name: 'ProxyListDownload', url: 'https://www.proxy-list.download/api/v1/get?type=http' },\n            { name: 'ProxyScan', url: 'https://www.proxyscan.io/download?type=http' }\n        ];\n\n        // Safety Check: Check for active scans\n        const activeScans = await prisma.scan.findFirst({\n            where: { status: 'RUNNING' }\n        });\n\n        if (activeScans) {\n            return NextResponse.json({\n                success: false,\n                logs: ['[CAUTION] Active scan detected.', '[ABORT] Proxy pool synchronization paused to prevent routing instability.'],\n                count: 0\n            });\n        }\n\n        let allProxies: string[] = [];\n        const logs: string[] = [];\n\n        for (const source of sources) {\n            try {\n                console.log(`[ProxyFetch] Fetching from ${source.name}: ${source.url}`);\n                const controller = new AbortController();\n                const timeoutId = setTimeout(() => controller.abort(), 8000); // 8s timeout per source\n\n                const res = await fetch(source.url, {\n                    next: { revalidate: 3600 },\n                    signal: controller.signal\n                }).finally(() => clearTimeout(timeoutId));\n\n                if (!res.ok) throw new Error(`HTTP ${res.status}`);\n\n                const text = await res.text();\n                const lines = text.split('\\n')\n                    .map(l => l.trim())\n                    .filter(l => l.includes(':') && l.length > 5);\n\n                allProxies = [...allProxies, ...lines];\n                console.log(`[ProxyFetch] ${source.name}: Got ${lines.length} proxies`);\n                logs.push(`Fetched ${lines.length} proxies from ${source.name}`);\n            } catch (err: any) {\n                console.error(`[ProxyFetch] Failed ${source.name}:`, err.message);\n                logs.push(`Failed to fetch from ${source.name}: ${err.message}`);\n            }\n        }\n\n        console.log(`[ProxyFetch] Total unique potential proxies: ${new Set(allProxies).size}`);\n        const uniqueEntries = Array.from(new Set(allProxies)).slice(0, 500);\n\n        const proxyData = uniqueEntries.map(entry => {\n            const [host, portStr] = entry.split(':');\n            return {\n                host,\n                port: parseInt(portStr),\n                type: 'DATACENTER' as const,\n                enabled: true\n            };\n        }).filter(p => p.host && !isNaN(p.port));\n\n        console.log(`[ProxyFetch] Saving ${proxyData.length} unique proxies...`);\n\n        // SQLite doesn't support skipDuplicates in createMany. \n        // We filter out existing proxies manually to avoid unique constraint violations.\n        const existingProxies = await (prisma as any).proxy.findMany({\n            select: { host: true, port: true }\n        });\n\n        const existingKeys = new Set(existingProxies.map((p: any) => `${p.host}:${p.port}`));\n        const newProxies = proxyData.filter(p => !existingKeys.has(`${p.host}:${p.port}`));\n\n        console.log(`[ProxyFetch] Detected ${newProxies.length} new unique proxies (Filtered ${proxyData.length - newProxies.length} duplicates)`);\n\n        let count = 0;\n        if (newProxies.length > 0) {\n            const result = await (prisma as any).proxy.createMany({\n                data: newProxies\n            });\n            count = result.count;\n        }\n\n        console.log(`[ProxyFetch] Sync complete. Added ${count} new proxies.`);\n\n        return NextResponse.json({\n            success: true,\n            sources: sources.map(s => s.name),\n            logs: [...logs, `[SYNC] Added ${count} new unique routing coordinates.`],\n            count: count\n        });\n\n    } catch (error: any) {\n        console.error('[ProxyFetch] Global error:', error);\n        return NextResponse.json({\n            success: false,\n            error: 'Failed to fetch proxies',\n            details: error.message\n        }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":"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"}}]
}